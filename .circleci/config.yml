version: 2.1
orbs:
  saucectl: saucelabs/saucectl-run@1.0.0

jobs:
  test-sauce:
    docker:
    - image: "circleci/node:14-browsers"

    steps:
    - checkout
    - saucectl/saucectl-run

    - restore_cache:
        key: node-{{ .Branch }}-0001
    - run: yarn
    - run: yarn run lerna bootstrap
    - save_cache:
        key: node-{{ .Branch }}-0001
        paths:
          - node_modules
          - /home/circleci/.cache/yarn/v1
    - run: yarn test
